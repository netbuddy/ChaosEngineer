# 软件调试

## 分支主题 4

## 防御式编程(Defensive Programming)

## 速错设计

### 速错是计算机的一种错误处理模式，程序设计者希望自己的程序能够把错误尽早暴露出来，及时修复，避免更大的破坏。拼写错误、源数据错误、
从故障发生到其被检测到的间隔时间——即潜伏时间——越长,代价就会越大,因为这样会增加对故障进行回退分析的复杂性

### 速错和容错的关系

### 错误指的是可能出现问题的地方出现了问题，比如打开一个文件时失败，这种情况在人们的意料之中；而异常指的是不应该出现问题的地方出现了问题，比如引用了空指针，这种情况在人们的意料之外，即程序运行到了不应该出现的代码分支或访问了没有权限的内存区域。可见，错误是业务过程的一部分，而异常不是 。
什么情况下用错误表达，什么情况下用异常表达，就得有一套规则。对于异常，我们可以选择在一个合适的上游去捕获它并打印记录堆栈信息，然后选择是直接崩溃还是采取其它补救措施，把业务逻辑和异常处理逻辑分离。

### 引入速错设计的前提是具备完善的快速恢复能力，关键技术包括进程监控、启动脚本、状态与代码相分离、检查点技术（参考数据库的redo）

### 参考资料

- [Go] 如何正确地 抛出 错误 和 异常（error/panic/recover）？
https://www.cnblogs.com/52php/p/6892651.html
- 被时间“埋没”的高并发王者：Erlang
https://zhuanlan.zhihu.com/p/336280783

## 指针问题

### 类型

- 野指针(wild pointer)

	- A wild pointer is a pointer that has not been correctly initialized and therefore points to some random piece of memory.
就是没有被初始化过的指针

- 悬空指针(dangling pointer)

	- A dangling pointer is a pointer that used to point to a valid address but now no longer does. This is usually due to that memory location being freed up and no longer available.
是指针最初指向的内存已经被释放了的一种指针。

- 飞指针

	- 对正常指针进行一系列算术计算后，指向一片非预期的内存区域
	- 与业务逻辑相关，无法用工具进行检测，只能代码审查和日志记录

### 危害

- 无论是野指针还是悬空指针，都是指向无效内存区域(这里的无效指的是"不安全不可控")的指针。 访问"不安全可控"(invalid)的内存区域将导致"Undefined Behavior"。

## 观点

### 大型的系统往往在交付的时候还存在着许多软件错误,然而我们却奢望它们能够运行正常。

### 单写多读，只有一个任务能对共享对象进行写操作
与其让有副作用的代码均匀地散布在整个系统中,不如希望能够把大量的副作用限制在少数“脏”模块中,而大多数模块都以无副作用的方式编写,与“脏”模块组合起来成为整个系统。

### 进程的偏离性检测

### 微服务的目的是避免进程大而不能倒

### 错误和异常是进程内部自身的感受，定义为获取到的参数信息与期望的参数信息之间的背离，故障(failure)则是外界对进程的感受，定义为观察到的系统行为与期望的系统行为之间的背离
错误、异常和故障是一种层进的关系。如果错误的影响域是局部非关键性的且补救措施对后继流程不会造成大的影响，则可在错误发生处进行纠正，并记录、反馈错误描述和补救措施
如果该错误是关键性的，对发生错误的地方后续求值已经变得没有意义，这个时候就应该把错误变为异常并抛出
如果一个异常产生了但是没有“捕捉处理者”
(catch handler)  ,那么该进程将会发生故障。

### 如果一个黑盒子函数的实现发生故障,那么在对该模块重启调用多次仍失败后，可以切换到黑盒子函数的另一个较简单的实现。

### 最小惊讶原则

*XMind - Trial Version*